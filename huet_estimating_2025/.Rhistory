# theme
#scale_color_binned(type = "viridis")+
scale_color_discrete("Significant differences \n \n FQS > Conventional") +
scale_size_binned("% difference \n with conventional",range = c(1, 10)) +
labs(x = "Practices (mean)", y = "Products") +
theme_light() +
theme(axis.text = element_text(size = 8,angle = 45,vjust = 1,hjust = 1),
text = element_text(size = 8),
legend.position = "right",
legend.box="vertical",
legend.margin = margin(),
legend.direction = "vertical",
legend.justification  = "right"
)
ggsave(plot = tmp_plot,
filename = "images/fig-results_practices_crops.svg",
width = 190/1,height = 240/2,units = "mm")
tmp_plot <- ggplot() +
# circles
geom_count(data = tmp_plot_data,
aes(x = practice, y = plot_x,
colour = plot_count_colour,
size = plot_count_size)
) +
# means
geom_text(data = tmp_plot_data,
aes(x = practice, y = plot_x,
label = format(plot_mean,scientific = T,digits = 2)),
size = 5,angle = 45, colour = "#666666") +
# theme
#scale_color_binned(type = "viridis")+
scale_color_discrete("Significant differences \n \n FQS > Conventional") +
scale_size_binned("% difference \n with conventional",range = c(1, 10)) +
labs(x = "Practices (mean)", y = "Products") +
theme_light() +
theme(axis.text = element_text(size = 8,angle = 45,vjust = 1,hjust = 1),
text = element_text(size = 8),
legend.position = "right",
legend.box="vertical",
legend.margin = margin(),
legend.direction = "vertical",
legend.justification  = "right"
)
ggsave(plot = tmp_plot,
filename = "images/fig-results_practices_crops.svg",
width = 190/1,height = 240/2,units = "mm")
tmp_plot <- ggplot() +
# circles
geom_count(data = tmp_plot_data,
aes(x = practice, y = plot_x,
colour = plot_count_colour,
size = plot_count_size)
) +
# means
geom_text(data = tmp_plot_data,
aes(x = practice, y = plot_x,
label = format(plot_mean,scientific = T,digits = 2)),
size = 1,angle = 45, colour = "#666666") +
# theme
#scale_color_binned(type = "viridis")+
scale_color_discrete("Significant differences \n \n FQS > Conventional") +
scale_size_binned("% difference \n with conventional",range = c(1, 10)) +
labs(x = "Practices (mean)", y = "Products") +
theme_light() +
theme(axis.text = element_text(size = 8,angle = 45,vjust = 1,hjust = 1),
text = element_text(size = 8),
legend.position = "right",
legend.box="vertical",
legend.margin = margin(),
legend.direction = "vertical",
legend.justification  = "right"
)
tmp_plot
tmp_plot <- ggplot() +
# circles
geom_count(data = tmp_plot_data,
aes(x = practice, y = plot_x,
colour = plot_count_colour,
size = plot_count_size)
) +
# means
geom_text(data = tmp_plot_data,
aes(x = practice, y = plot_x,
label = format(plot_mean,scientific = T,digits = 2)),
size = 2,angle = 45, colour = "#666666") +
# theme
#scale_color_binned(type = "viridis")+
scale_color_discrete("Significant differences \n \n FQS > Conventional") +
scale_size_binned("% difference \n with conventional",range = c(1, 10)) +
labs(x = "Practices (mean)", y = "Products") +
theme_light() +
theme(axis.text = element_text(size = 8,angle = 45,vjust = 1,hjust = 1),
text = element_text(size = 8),
legend.position = "right",
legend.box="vertical",
legend.margin = margin(),
legend.direction = "vertical",
legend.justification  = "right"
)
tmp_plot
tmp_plot <- ggplot() +
# circles
geom_count(data = tmp_plot_data,
aes(x = practice, y = plot_x,
colour = plot_count_colour,
size = plot_count_size)
) +
# means
geom_text(data = tmp_plot_data,
aes(x = practice, y = plot_x,
label = format(plot_mean,scientific = T,digits = 2)),
size = 3,angle = 45, colour = "#666666") +
# theme
#scale_color_binned(type = "viridis")+
scale_color_discrete("Significant differences \n \n FQS > Conventional") +
scale_size_binned("% difference \n with conventional",range = c(1, 10)) +
labs(x = "Practices (mean)", y = "Products") +
theme_light() +
theme(axis.text = element_text(size = 8,angle = 45,vjust = 1,hjust = 1),
text = element_text(size = 8),
legend.position = "right",
legend.box="vertical",
legend.margin = margin(),
legend.direction = "vertical",
legend.justification  = "right"
)
tmp_plot
tmp_plot <- ggplot() +
# circles
geom_count(data = tmp_plot_data,
aes(x = practice, y = plot_x,
colour = plot_count_colour,
size = plot_count_size)
) +
# means
geom_text(data = tmp_plot_data,
aes(x = practice, y = plot_x,
label = format(plot_mean,scientific = T,digits = 2)),
size = 5,angle = 45, colour = "#666666") +
# theme
#scale_color_binned(type = "viridis")+
scale_color_discrete("Significant differences \n \n FQS > Conventional") +
scale_size_binned("% difference \n with conventional",range = c(1, 10)) +
labs(x = "Practices (mean)", y = "Products") +
theme_light() +
theme(axis.text = element_text(size = 8,angle = 45,vjust = 1,hjust = 1),
text = element_text(size = 8),
legend.position = "right",
legend.box="vertical",
legend.margin = margin(),
legend.direction = "vertical",
legend.justification  = "right"
)
tmp_plot
tmp_plot <- ggplot() +
# circles
geom_count(data = tmp_plot_data,
aes(x = practice, y = plot_x,
colour = plot_count_colour,
size = plot_count_size)
) +
# means
geom_text(data = tmp_plot_data,
aes(x = practice, y = plot_x,
label = format(plot_mean,scientific = T,digits = 2)),
size = 4,angle = 45, colour = "#666666") +
# theme
#scale_color_binned(type = "viridis")+
scale_color_discrete("Significant differences \n \n FQS > Conventional") +
scale_size_binned("% difference \n with conventional",range = c(1, 10)) +
labs(x = "Practices (mean)", y = "Products") +
theme_light() +
theme(axis.text = element_text(size = 8,angle = 45,vjust = 1,hjust = 1),
text = element_text(size = 8),
legend.position = "right",
legend.box="vertical",
legend.margin = margin(),
legend.direction = "vertical",
legend.justification  = "right"
)
tmp_plot
tmp_plot <- ggplot() +
# circles
geom_count(data = tmp_plot_data,
aes(x = practice, y = plot_x,
colour = plot_count_colour,
size = plot_count_size)
) +
# means
geom_text(data = tmp_plot_data,
aes(x = practice, y = plot_x,
label = format(plot_mean,scientific = T,digits = 2)),
size = 3.5,angle = 45, colour = "#666666") +
# theme
#scale_color_binned(type = "viridis")+
scale_color_discrete("Significant differences \n \n FQS > Conventional") +
scale_size_binned("% difference \n with conventional",range = c(1, 10)) +
labs(x = "Practices (mean)", y = "Products") +
theme_light() +
theme(axis.text = element_text(size = 8,angle = 45,vjust = 1,hjust = 1),
text = element_text(size = 8),
legend.position = "right",
legend.box="vertical",
legend.margin = margin(),
legend.direction = "vertical",
legend.justification  = "right"
)
tmp_plot
ggsave(plot = tmp_plot,
filename = "images/fig-results_practices_crops.svg",
width = 190/1,height = 240/2,units = "mm")
library(dplyr)
library(tidyr)
library(ggplot2)
tmp_plot_data <- tmp_table0 %>%
# select only one practice for some products
filter(
practice_subset == "herd"
& production_type == "milk"
& product_name %in% tmp_product_names$labels[tmp_product_names$plot == T]
& FQS %in% tmp_FQS_names$labels[tmp_FQS_names$plot == T]) %>%
# add conventional mean
inner_join(.,tmp_table0 %>%
filter(FQS %in% c("Conventional","Counterfactual")) %>%
group_by(product_name,match,practice) %>%
reframe(mean_conv = mean,.groups = "keep"),
by = join_by(product_name, practice, match)) %>%
# change names for counterfactuals
filter(match == "no_match" | FQS != "Conventional") %>%
mutate(FQS = factor(case_when(
match == "no_match" ~ FQS,
match != "no_match" ~ "Counterfactual"
))) %>%
# add asterisk when signif
mutate(
stat_grp = case_when(
match == "no_match" ~ stat_grp,
match != "no_match" & padjust_bonf <= 0.05 ~ "*",
.default = ""
)) %>%
# add plot_x
mutate(
plot_x = paste0(product_name,match,FQS)
)
tmp_plot_order <- tibble(
plot_x = rev(c("Milkno_matchConventional",
"Milkno_matchOrganic Farming",
"MilkLait__ABCounterfactual",
"Milkno_matchCharentes-Poitou Butter",
"MilkLait__Beurre de Charentes-PoitouCounterfactual",
"Milkno_matchComtÃ© - Morbier",
"MilkLait__Comte - MorbierCounterfactual"
)),
labels = rev(c("Milk - Conventional",
"Milk - Organic Farming",
"Milk - Counterfactual Organic Farming",
"Milk - Charentes-Poitou Butter",
"Milk - Counterfactual Charentes-Poitou Butter",
"Milk - Comte - Morbier",
"Milk - Counterfactual Comte - Morbier")))
tmp_plot_data$plot_x <- factor(tmp_plot_data$plot_x,
levels = tmp_plot_order$plot_x,
labels = tmp_plot_order$labels)
tmp_plot_data$production_type <- toupper(tmp_plot_data$production_type)
tmp_plot_data <- tmp_plot_data %>%
filter(!is.na(plot_x) & !is.na(practice)) %>%
mutate(
plot_count_size = case_when(
pval_tukey <= 0.05 | padjust_bonf <= 0.05 ~ abs((mean_conv - mean)/mean_conv*100),
.default = NA
),
plot_count_colour = case_when(
mean/mean_conv > 1 ~ T,
.default = F
),
plot_mean = case_when(
FQS == "Counterfactual" ~ mean_conv,
.default = mean
)
) %>%
filter(practice %in% practice_names$herd$labels[c(1,3,6,8,10,12,14,16,17,19)])
tmp_plot <- ggplot() +
# circles
geom_count(data = tmp_plot_data,
aes(x = practice, y = plot_x,
colour = plot_count_colour,
size = plot_count_size)
) +
# means
geom_text(data = tmp_plot_data,
aes(x = practice, y = plot_x,
label = format(plot_mean,scientific = T,digits = 2)),
size = 3.5, angle = 45, colour = "#666666") +
# theme
#scale_color_binned(type = "viridis")+
scale_color_discrete("Significant differences \n \n FQS > Conventional") +
scale_size_binned("% difference \n with conventional",range = c(1, 12.5)) +
labs(x = "Practices (mean)", y = "Products") +
theme_light() +
theme(axis.text = element_text(size = 8,angle = 45,vjust = 1,hjust = 1),
text = element_text(size = 8),
legend.position = "right",
legend.box="vertical",
legend.margin = margin(),
legend.direction = "vertical",
legend.justification  = "right"
)
ggsave(plot = tmp_plot,
filename = "images/fig-results_practices_crops.svg",
width = 190/1,height = 240/2,units = "mm")
tmp_plot_data <- tmp_table0 %>%
# select only one practice for some products
filter(
practice_subset == "crops"
& production_type == "crop"
& product_name %in% tmp_product_names$labels[tmp_product_names$plot == T]
& FQS %in% tmp_FQS_names$labels[tmp_FQS_names$plot == T]) %>%
# add conventional mean
inner_join(.,tmp_table0 %>%
filter(FQS %in% c("Conventional","Counterfactual")) %>%
group_by(product_name,match,practice) %>%
reframe(mean_conv = mean,.groups = "keep"),
by = join_by(product_name, practice, match)) %>%
# change names for counterfactuals
filter(match == "no_match" | FQS != "Conventional") %>%
mutate(FQS = factor(case_when(
match == "no_match" ~ FQS,
match != "no_match" ~ "Counterfactual"
))) %>%
# add asterisk when signif
mutate(
stat_grp = case_when(
match == "no_match" ~ stat_grp,
match != "no_match" & padjust_bonf <= 0.05 ~ "*",
.default = ""
)) %>%
# add plot_x
mutate(
plot_x = paste0(product_name,match,FQS)
)
tmp_plot_order <- tibble(
plot_x = rev(c("Soft Wheatno_matchConventional",
"Soft Wheatno_matchOrganic Farming",
"Soft WheatBle_tendre__ABCounterfactual",
"Soft Wheatno_matchLabel Rouge",
"Soft WheatBle_tendre__LRCounterfactual",
"Grain Maizeno_matchConventional",
"Grain Maizeno_matchOrganic Farming",
"Grain MaizeMais_grain__ABCounterfactual"
)),
labels = rev(c("Soft Wheat - Conventional",
"Soft Wheat - Organic Farming",
"Soft Wheat - Counterfactual Organic Farming",
"Soft Wheat - Label Rouge",
"Soft Wheat - Counterfactual Label Rouge",
"Grain Maize - Conventional",
"Grain Maize - Organic Farming",
"Grain Maize - Counterfactual Organic Farming"
)))
tmp_plot_data$plot_x <- factor(tmp_plot_data$plot_x,
levels = tmp_plot_order$plot_x,
labels = tmp_plot_order$labels)
tmp_plot_data$production_type <- toupper(tmp_plot_data$production_type)
tmp_plot_data <- tmp_plot_data %>%
filter(!is.na(plot_x) & !is.na(practice)) %>%
mutate(
plot_count_size = case_when(
pval_tukey <= 0.05 | padjust_bonf <= 0.05 ~ abs((mean_conv - mean)/mean_conv*100),
.default = NA
),
plot_count_colour = case_when(
mean/mean_conv > 1 ~ T,
.default = F
),
plot_mean = case_when(
FQS == "Counterfactual" ~ mean_conv,
.default = mean
)
) %>%
# filter practices
filter(practice %in% practice_names$crops$labels[-1])
tmp_plot <- ggplot() +
# circles
geom_count(data = tmp_plot_data,
aes(x = practice, y = plot_x,
colour = plot_count_colour,
size = plot_count_size)
) +
# means
geom_text(data = tmp_plot_data,
aes(x = practice, y = plot_x,
label = format(plot_mean,scientific = T,digits = 2)),
size = 3.5,angle = 45, colour = "#666666") +
# theme
#scale_color_binned(type = "viridis")+
scale_color_discrete("Significant differences \n \n FQS > Conventional") +
scale_size_binned("% difference \n with conventional",range = c(1, 10)) +
labs(x = "Practices (mean)", y = "Products") +
theme_light() +
theme(axis.text = element_text(size = 8,angle = 45,vjust = 1,hjust = 1),
text = element_text(size = 8),
legend.position = "right",
legend.box="vertical",
legend.margin = margin(),
legend.direction = "vertical",
legend.justification  = "right"
)
ggsave(plot = tmp_plot,
filename = "images/fig-results_practices_crops.svg",
width = 190/1,height = 240/2,units = "mm")
library(dplyr)
library(tidyr)
library(ggplot2)
tmp_plot_data <- tmp_table0 %>%
# select only one practice for some products
filter(
practice_subset == "herd"
& production_type == "milk"
& product_name %in% tmp_product_names$labels[tmp_product_names$plot == T]
& FQS %in% tmp_FQS_names$labels[tmp_FQS_names$plot == T]) %>%
# add conventional mean
inner_join(.,tmp_table0 %>%
filter(FQS %in% c("Conventional","Counterfactual")) %>%
group_by(product_name,match,practice) %>%
reframe(mean_conv = mean,.groups = "keep"),
by = join_by(product_name, practice, match)) %>%
# change names for counterfactuals
filter(match == "no_match" | FQS != "Conventional") %>%
mutate(FQS = factor(case_when(
match == "no_match" ~ FQS,
match != "no_match" ~ "Counterfactual"
))) %>%
# add asterisk when signif
mutate(
stat_grp = case_when(
match == "no_match" ~ stat_grp,
match != "no_match" & padjust_bonf <= 0.05 ~ "*",
.default = ""
)) %>%
# add plot_x
mutate(
plot_x = paste0(product_name,match,FQS)
)
tmp_plot_order <- tibble(
plot_x = rev(c("Milkno_matchConventional",
"Milkno_matchOrganic Farming",
"MilkLait__ABCounterfactual",
"Milkno_matchCharentes-Poitou Butter",
"MilkLait__Beurre de Charentes-PoitouCounterfactual",
"Milkno_matchComtÃ© - Morbier",
"MilkLait__Comte - MorbierCounterfactual"
)),
labels = rev(c("Milk - Conventional",
"Milk - Organic Farming",
"Milk - Counterfactual Organic Farming",
"Milk - Charentes-Poitou Butter",
"Milk - Counterfactual Charentes-Poitou Butter",
"Milk - Comte - Morbier",
"Milk - Counterfactual Comte - Morbier")))
tmp_plot_data$plot_x <- factor(tmp_plot_data$plot_x,
levels = tmp_plot_order$plot_x,
labels = tmp_plot_order$labels)
tmp_plot_data$production_type <- toupper(tmp_plot_data$production_type)
tmp_plot_data <- tmp_plot_data %>%
filter(!is.na(plot_x) & !is.na(practice)) %>%
mutate(
plot_count_size = case_when(
pval_tukey <= 0.05 | padjust_bonf <= 0.05 ~ abs((mean_conv - mean)/mean_conv*100),
.default = NA
),
plot_count_colour = case_when(
mean/mean_conv > 1 ~ T,
.default = F
),
plot_mean = case_when(
FQS == "Counterfactual" ~ mean_conv,
.default = mean
)
) %>%
filter(practice %in% practice_names$herd$labels[c(1,3,6,8,10,12,14,16,17,19)])
tmp_plot <- ggplot() +
# circles
geom_count(data = tmp_plot_data,
aes(x = practice, y = plot_x,
colour = plot_count_colour,
size = plot_count_size)
) +
# means
geom_text(data = tmp_plot_data,
aes(x = practice, y = plot_x,
label = format(plot_mean,scientific = T,digits = 2)),
size = 3.5, angle = 45, colour = "#666666") +
# theme
#scale_color_binned(type = "viridis")+
scale_color_discrete("Significant differences \n \n FQS > Conventional") +
scale_size_binned("% difference \n with conventional",range = c(1, 12.5)) +
labs(x = "Practices (mean)", y = "Products") +
theme_light() +
theme(axis.text = element_text(size = 8,angle = 45,vjust = 1,hjust = 1),
text = element_text(size = 8),
legend.position = "right",
legend.box="vertical",
legend.margin = margin(),
legend.direction = "vertical",
legend.justification  = "right"
)
ggsave(plot = tmp_plot,
filename = "images/fig-results_practices_herd.svg",
width = 190/1,height = 240/2,units = "mm")
ggsave(plot = tmp_plot,
filename = "images/fig-results_practices_herd.svg",
width = 190/1,height = 240/1.5,units = "mm")
