group_by(code_livestock) %>%
summarise(
AROPAJ = paste0(unique(na.omit(AROPAJ)),collapse = ";")
)
}
## AROPAJ
tmp_AROPAJ <- read_excel("data_in/supp_data.xlsx", sheet = "AROPAJ_France")
## assign average ratio by livestock code
tmp_ref_ration <- tmp_TT_livestock %>%
# select livestock code
filter(code_livestock %in% unique(tmp_input$code_livestock)) %>%
# add average ration
rowwise() %>%
mutate(
ref_DM_kg_LU = mean(tmp_AROPAJ$total_intake_tDM_LU_y[
tmp_AROPAJ$AROPAJ %in% unlist(strsplit(AROPAJ,";"))
],na.rm = T) *10^3
# AROPAJ data are in tonnes for one livestock unit
)
tmp_ration_th_pcode_livestock <- tmp_input %>%
# add average ration
left_join(., tmp_ref_ration %>% select(code_livestock,ref_DM_kg_LU)) %>% ungroup() %>%
# calculate theoretical average ration per code_livestock
mutate(th_DM_kg_code_livestock = ref_DM_kg_LU * livestock_unit)
tmp_ration_th_pfarm <- tmp_ration_th_pcode_livestock %>%
group_by(farm_id) %>%
summarise(th_DM_kg_pfarm = sum(th_DM_kg_code_livestock))
tmp_ration_th <- left_join(tmp_ration_th_pcode_livestock,tmp_ration_th_pfarm)
# total amount of feed by farm (kg year-1)
tmp_feed_by_farm = Reduce(rbind,list(feed_purchased %>% mutate(feed_origin = "feed_purchased"),
feed_produced %>% mutate(feed_origin = "feed_produced"),
feed_grassland %>% mutate(feed_origin = "feed_grassland")))
tmp_feed_by_livestock <- tmp_feed_by_farm %>%
# add livestock
inner_join(.,tmp_input,relationship = "many-to-many") %>%
# add theoretical ration from AROPAJ reference
left_join(., tmp_ration_th) %>%
# distribute DM
mutate(
# DM of each crop by livestock type: kg DM y-1
DM_kg_crop_livestock = DM_kg_crop * th_DM_kg_code_livestock / th_DM_kg_pfarm,
CP_kg_crop_livestock = CP_kg_crop * DM_kg_crop_livestock / DM_kg_crop,
# DM of each crop by animal: kg DM animal-1 y-1
DM_kg_crop_LU = DM_kg_crop_livestock / livestock_unit,
CP_kg_crop_LU = CP_kg_crop_livestock / livestock_unit)
tmp_ration_th_code_livestock <- tmp_input %>%
# add average ration
left_join(., tmp_ref_ration %>% select(code_livestock,ref_DM_kg_LU)) %>% ungroup() %>%
# calculate theoretical average ration per code_livestock
mutate(th_DM_kg_code_livestock = ref_DM_kg_LU * livestock_unit)
tmp_ration_th_farm <- tmp_ration_th_code_livestock %>%
group_by(farm_id) %>%
summarise(th_DM_kg_farm = sum(th_DM_kg_code_livestock))
tmp_ration_th <- left_join(tmp_ration_th_code_livestock,tmp_ration_th_farm)
# total amount of feed by farm (kg year-1)
tmp_feed_by_farm = Reduce(rbind,list(feed_purchased %>% mutate(feed_origin = "feed_purchased"),
feed_produced %>% mutate(feed_origin = "feed_produced"),
feed_grassland %>% mutate(feed_origin = "feed_grassland")))
tmp_feed_by_livestock <- tmp_feed_by_farm %>%
# add livestock
inner_join(.,tmp_input,relationship = "many-to-many") %>%
# add theoretical ration from AROPAJ reference
left_join(., tmp_ration_th) %>%
# distribute DM
mutate(
# DM of each crop by livestock type: kg DM y-1
DM_kg_crop_livestock = DM_kg_crop * th_DM_kg_code_livestock / th_DM_kg_farm,
GE_MJ_crop_livestock = GE_MJ_crop * th_DM_kg_code_livestock / th_DM_kg_farm,
CP_kg_crop_livestock = CP_kg_crop * DM_kg_crop_livestock / DM_kg_crop,
# DM of each crop by animal: kg DM animal-1 y-1
DM_kg_crop_LU = DM_kg_crop_livestock / livestock_unit,
GE_MJ_crop_LU = GE_MJ_crop_livestock / livestock_unit,
CP_kg_crop_LU = CP_kg_crop_livestock / livestock_unit)
# quality check ----
# je dois retrouver des totaux similaires aux théroques par LU
tmp_check_farm_id = sample(tmp_feed_by_livestock$farm_id,size = 25)
tmp = tmp_feed_by_livestock %>%
filter(farm_id %in% tmp_check_farm_id) %>%
group_by(farm_id,crop,feed_origin) %>%
summarise(
DM_kg_crop = sum(unique(DM_kg_crop)),
DM_kg_crop_livestock = sum(DM_kg_crop_livestock),
DM_kg_crop_LU = sum(DM_kg_crop_LU*livestock_unit),
GE_MJ_crop = sum(unique(GE_MJ_crop)),
GE_MJ_crop_livestock = sum(GE_MJ_crop_livestock),
GE_MJ_crop_LU = sum(GE_MJ_crop_LU*livestock_unit)) %>%
mutate(
check1 = round(DM_kg_crop) == round(DM_kg_crop_livestock),
check2 = round(DM_kg_crop) == round(DM_kg_crop_LU),
check3 = round(DM_kg_crop_livestock) == round(DM_kg_crop_LU),
check4 = round(GE_MJ_crop) == round(GE_MJ_crop_livestock),
check5 = round(GE_MJ_crop) == round(GE_MJ_crop_LU),
check6 = round(GE_MJ_crop_livestock) == round(GE_MJ_crop_LU)
)
print("Everything's good if all TRUE")
print(table(tmp$check1))
print(table(tmp$check2))
print(table(tmp$check3))
print(table(tmp$check4))
print(table(tmp$check5))
print(table(tmp$check6))
feed_by_livestock <- tmp_feed_by_livestock %>% ungroup()
rm(list = names(.GlobalEnv)[grep("tmp",names(.GlobalEnv))])
if (my_DB == "RICA") {
# transfert table
tmp_TT_livestock <- read_xlsx("data_in/supp_data.xlsx", sheet ="TT_livestock") %>%
rename(code_livestock = CODE6)
# RICA data
tmp_RICA_2020_anim <- RICA_2020_ani %>%
# add units
left_join(.,tmp_TT_livestock %>% select(CODE6,EFFEC6_unit,species)) %>%
# summaries populations
group_by(IDENT,CODE6) %>%
# /!\ warning: animal population units differ between years
summarise(EFFEC = sum(EFFEC6*EFFEC6_unit)) %>% ungroup() %>%
filter(
# remove livestock without population
EFFEC >0
# remove eggs & chicks
& CODE6 != 984
& CODE6 != 974
# remove bees
& CODE6 != 993
) %>%
# 4148 farms
rename(
farm_id =IDENT,
code_livestock = CODE6
) %>%
# add species and UGB
left_join(., tmp_TT_livestock) %>%
# data are for one animal, so need to convert in livestock unit using LSU coefficient (see eurostat)
mutate(
livestock_unit = EFFEC * UGB # add UGB from tmp_TT_livestock
)
}
if (my_DB == "FADN") {
# transfert table
tmp_FADN_code <- read_xlsx("data_in/supp_data.xlsx",sheet = "FADN_livestock_code")
tmp_TT_livestock0 <- read_xlsx("data_in/supp_data.xlsx", sheet ="TT_livestock")
tmp_TT_livestock <- tmp_TT_livestock0 %>%
# add row for diary buffalo
rbind(tmp_TT_livestock0 %>%
filter(FADN_code_letter == "LCOWDAIR") %>%
select(!all_of(colnames(tmp_FADN_code))) %>%
cbind(tmp_FADN_code %>%
filter(FADN_code_letter == "LBUFDAIRPRS"))) %>%
rename(code_livestock = FADN_code_letter) %>%
# concatenate when multiple rows for one FADN code
filter(!is.na(code_livestock)) %>%
group_by(code_livestock) %>%
summarise(
species = unique(na.omit(species)),
# for livestock categories, see Table 10.1 IPCC Guidelines 2019 Refinement
IPCC_mix_cat = paste0(unique(na.omit(unlist(strsplit(IPCC_mix_cat,";")))),collapse = ";"),
UGB = unique(na.omit(UGB))
)
# FADN data
tmp_input <- FADN_18 %>%
## livestock unit
select(ID, all_of(intersect(paste0(tmp_FADN_code$FADN_code_letter,"_ALU"),colnames(FADN_18)))) %>%
pivot_longer(cols = !c(ID),names_to = "code_livestock",values_to = "livestock_unit") %>%
rename(farm_id = ID) %>%
mutate(code_livestock = gsub("_ALU","",code_livestock)) %>%
# add species
left_join(., tmp_TT_livestock)  %>%
# add livestock unit coefficient to convert to animal
left_join(.,tmp_TT_livestock0 %>%
filter(!is.na(FADN_code_letter)) %>%
select(FADN_code_letter,UGB) %>%
distinct() %>%
rename(code_livestock = FADN_code_letter)) %>%
mutate(livestock_head = livestock_unit*UGB) %>%
# remove livestock without population
filter(livestock_unit >0 ) %>%
## milk production
left_join(
.,
FADN_18 %>%
# extract milk production
mutate(code_livestock = "LCOWDAIR",
prod_milk_kg = PMLKCOW_PRQ*10^3) %>%
rename(farm_id = ID) %>%
select(farm_id,code_livestock,prod_milk_kg))
}
tmp_feed_intake <- feed_by_livestock %>%
# add livestock unit coefficient to convert to animal
left_join(.,tmp_TT_livestock %>% select(code_livestock,UGB)) %>%
# estimate feed intake per animal using livestock unit coefficient to convert to animal
group_by(farm_id,code_livestock) %>%
summarise(
DM_kg_animal = sum(DM_kg_crop_LU*UGB),
# add crude protein content
CP_p100 = (sum(CP_kg_crop_LU*UGB) / DM_kg_animal)*100)
tmp_cattle_CH4_EF <- tmp_input %>%
# filter cattle
filter(species == "cattle") %>% # 3053 farms
# add feed intake data
inner_join(.,tmp_feed_intake)
tmp_feed_intake <- feed_by_livestock %>%
# add livestock unit coefficient to convert to animal
left_join(.,tmp_TT_livestock %>% select(code_livestock,UGB)) %>%
# estimate feed intake per animal using livestock unit coefficient to convert to animal
group_by(farm_id,code_livestock) %>%
summarise(
DM_kg_animal = sum(DM_kg_crop_LU*UGB),
GE_MJ_animal = sum(GE_MJ_crop_LU*UGB),
# add crude protein content
CP_p100 = (sum(CP_kg_crop_LU*UGB) / DM_kg_animal)*100)
tmp_cattle_CH4_EF <- tmp_input %>%
# filter cattle
filter(species == "cattle") %>% # 3053 farms
# add feed intake data
inner_join(.,tmp_feed_intake)
tmp_cattle_CH4_EF <- tmp_input %>%
# filter cattle
filter(species == "cattle") %>% # 3053 farms
# add feed intake data
inner_join(.,tmp_feed_intake) %>%
# estimate CH4 emission from enteric fermentation
rowwise() %>%
mutate(
## Digestibility
## DE: digestibility of feed expressed as a fraction of gross energy (digestible energy/gross energy*100, i.e. DE%)
## Tables 10A.1 & 10A.2
DE = case_when(
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod")) ~ 71,
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("bulls_breed")) ~ 60,
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("other_mature_cattle")) ~ 60, # as mature males
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("growing_cattle_postweaning")) ~ 65,
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("growing_cattle")) ~ 65,
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("calves_preweaning")) & code_livestock !=  932 ~ 95, # calves on milk
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("calves_preweaning")) & code_livestock == 932 ~ 73 # calves on forage (broutards only ???)
),
# WIP !!! we could estimate DE = qté aliment - prod lait
#  Ym = methane conversion factor, per cent of gross energy in feed converted to methane (Table 10.12)
## In Table 10.12, the MY of dairy cows is linked to annual milk production levels and to feed quantity and quality
## diary cow productivity in kg milk /head/yr-1
Ym = case_when(
# diary cattle
## WIP /!\ should differentiate between high producing cows depending on Neutral Detergent Fibre (NDF, % DMI)
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod")) & prod_milk_kg/livestock_head > 8500 ~ (5.7+6)/2,
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod")) & prod_milk_kg/livestock_head <= 8500 & prod_milk_kg/livestock_head >= 5000 ~ 6.3,
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod")) & prod_milk_kg/livestock_head < 5000 ~ 6.5,
# other cattle
species == "cattle"
& !any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod"))
& DE <= 62 ~ 7.0,
species == "cattle"
& !any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod"))
& DE > 62 & DE <= 71 ~ 6.3,
species == "cattle"
& !any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod"))
& DE >= 72 & DE < 75 ~ 4.0,
species == "cattle"
& !any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod"))
& DE >= 75 ~ 3.0
),
# EQUATION 10.21 METHANE EMISSION FACTORS FOR ENTERIC FERMENTATION FROM A LIVESTOCK CATEGORY
## EF = (GE *(Ym / 100)*365)/ 55.65
### EF = emission factor, kg CH4 head-1 yr-1
### GE = gross energy intake, MJ head-1 day-1
### Ym = methane conversion factor, per cent of gross energy in feed converted to methane
### The factor 55.65 (MJ/kg CH4) is the energy content of methane
### here GE_MJ_animal = gross energy intake, MJ head-1 yr-1
EF_Ym = (GE_MJ_animal * (Ym/100)) / 55.65,
#  MY = Methane yield, g CH4 kg DMI-1 (Table 10.12)
## In Table 10.12, the MY of dairy cows is linked to annual milk production levels and to feed quantity and quality
## diary cow productivity in kg milk /head/yr-1
MY = case_when(
# diary cattle
## WIP /!\ should differentiate between high producing cows depending on Neutral Detergent Fibre (NDF, % DMI)
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod")) & prod_milk_kg/livestock_head > 8500 ~ (19+20)/2,
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod")) & prod_milk_kg/livestock_head <= 8500 & prod_milk_kg/livestock_head >= 5000 ~ 21,
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod")) & prod_milk_kg/livestock_head < 5000 ~ 21.4,
# other cattle
species == "cattle"
& !any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod"))
& DE <= 62 ~ 23.3,
species == "cattle"
& !any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod"))
& DE > 62 & DE <= 71 ~ 21,
species == "cattle"
& !any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod"))
& DE >= 72 & DE < 75 ~ 13.6,
species == "cattle"
& !any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod"))
& DE >= 75 ~ 10
),
# EQUATION 10.21A (NEW) METHANE EMISSION FACTORS FOR ENTERIC FERMENTATION FROM A LIVESTOCK CATEGORY
## EF = DMI * (MY/1000) * 365
### EF = emission factor, kg CH4 head-1 yr-1
### DMI = kg DMI day-1
### MY = Methane yield, g CH4 kg DMI-1 (Table 10.12)
### 365 = days per year
### 1000 = conversion from g CH4 to kg CH4
### here DM_kg_animal = kg DMI head-1 yr-1
EF_MY = DM_kg_animal * (MY / 1000),
# "To estimate total emissions, the selected emission factors are multiplied by the associated animal population [...]. As described above under Tier 1, the emissions estimates should be reported in gigagrams (Gg)." (IPCC Guidelines 2019 Refinements)
## CH4_EF = kg CH4 yr-1
CH4_EF_Ym = livestock_head * EF_Ym
CH4_EF_MY = livestock_head * EF_MY
tmp_cattle_CH4_EF <- tmp_input %>%
# filter cattle
filter(species == "cattle") %>% # 3053 farms
# add feed intake data
inner_join(.,tmp_feed_intake) %>%
# estimate CH4 emission from enteric fermentation
rowwise() %>%
mutate(
## Digestibility
## DE: digestibility of feed expressed as a fraction of gross energy (digestible energy/gross energy*100, i.e. DE%)
## Tables 10A.1 & 10A.2
DE = case_when(
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod")) ~ 71,
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("bulls_breed")) ~ 60,
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("other_mature_cattle")) ~ 60, # as mature males
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("growing_cattle_postweaning")) ~ 65,
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("growing_cattle")) ~ 65,
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("calves_preweaning")) & code_livestock !=  932 ~ 95, # calves on milk
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("calves_preweaning")) & code_livestock == 932 ~ 73 # calves on forage (broutards only ???)
),
# WIP !!! we could estimate DE = qté aliment - prod lait
#  Ym = methane conversion factor, per cent of gross energy in feed converted to methane (Table 10.12)
## In Table 10.12, the MY of dairy cows is linked to annual milk production levels and to feed quantity and quality
## diary cow productivity in kg milk /head/yr-1
Ym = case_when(
# diary cattle
## WIP /!\ should differentiate between high producing cows depending on Neutral Detergent Fibre (NDF, % DMI)
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod")) & prod_milk_kg/livestock_head > 8500 ~ (5.7+6)/2,
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod")) & prod_milk_kg/livestock_head <= 8500 & prod_milk_kg/livestock_head >= 5000 ~ 6.3,
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod")) & prod_milk_kg/livestock_head < 5000 ~ 6.5,
# other cattle
species == "cattle"
& !any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod"))
& DE <= 62 ~ 7.0,
species == "cattle"
& !any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod"))
& DE > 62 & DE <= 71 ~ 6.3,
species == "cattle"
& !any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod"))
& DE >= 72 & DE < 75 ~ 4.0,
species == "cattle"
& !any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod"))
& DE >= 75 ~ 3.0
),
# EQUATION 10.21 METHANE EMISSION FACTORS FOR ENTERIC FERMENTATION FROM A LIVESTOCK CATEGORY
## EF = (GE *(Ym / 100)*365)/ 55.65
### EF = emission factor, kg CH4 head-1 yr-1
### GE = gross energy intake, MJ head-1 day-1
### Ym = methane conversion factor, per cent of gross energy in feed converted to methane
### The factor 55.65 (MJ/kg CH4) is the energy content of methane
### here GE_MJ_animal = gross energy intake, MJ head-1 yr-1
EF_Ym = (GE_MJ_animal * (Ym/100)) / 55.65,
#  MY = Methane yield, g CH4 kg DMI-1 (Table 10.12)
## In Table 10.12, the MY of dairy cows is linked to annual milk production levels and to feed quantity and quality
## diary cow productivity in kg milk /head/yr-1
MY = case_when(
# diary cattle
## WIP /!\ should differentiate between high producing cows depending on Neutral Detergent Fibre (NDF, % DMI)
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod")) & prod_milk_kg/livestock_head > 8500 ~ (19+20)/2,
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod")) & prod_milk_kg/livestock_head <= 8500 & prod_milk_kg/livestock_head >= 5000 ~ 21,
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod")) & prod_milk_kg/livestock_head < 5000 ~ 21.4,
# other cattle
species == "cattle"
& !any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod"))
& DE <= 62 ~ 23.3,
species == "cattle"
& !any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod"))
& DE > 62 & DE <= 71 ~ 21,
species == "cattle"
& !any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod"))
& DE >= 72 & DE < 75 ~ 13.6,
species == "cattle"
& !any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod"))
& DE >= 75 ~ 10
),
# EQUATION 10.21A (NEW) METHANE EMISSION FACTORS FOR ENTERIC FERMENTATION FROM A LIVESTOCK CATEGORY
## EF = DMI * (MY/1000) * 365
### EF = emission factor, kg CH4 head-1 yr-1
### DMI = kg DMI day-1
### MY = Methane yield, g CH4 kg DMI-1 (Table 10.12)
### 365 = days per year
### 1000 = conversion from g CH4 to kg CH4
### here DM_kg_animal = kg DMI head-1 yr-1
EF_MY = DM_kg_animal * (MY / 1000),
# "To estimate total emissions, the selected emission factors are multiplied by the associated animal population [...]. As described above under Tier 1, the emissions estimates should be reported in gigagrams (Gg)." (IPCC Guidelines 2019 Refinements)
## CH4_EF = kg CH4 yr-1
CH4_EF_Ym = livestock_head * EF_Ym,
CH4_EF_MY = livestock_head * EF_MY
) %>%
ungroup()
quantile(tmp_cattle_CH4_EF$CH4_EF_MY)
quantile(tmp_cattle_CH4_EF$CH4_EF_Ym)
tmp_cattle_CH4_EF <- tmp_cattle_CH4_EF %>% mutate(CH4_EF = (CH4_EF_Ym+CH4_EF_MY)/2)
quantile(tmp_cattle_CH4_EF$CH4_EF)
# compare with Tier 1 method
tmp_check_tier1 <- tmp_input %>%
filter(species == "cattle") %>%
mutate(
EF = case_when(
any(unlist(strsplit(IPCC_mix_cat,";")) %in% c("cows_milk_prod")) ~ 126,
.default = 52
),
CH4_tier1 = livestock_head * EF
)
quantile(tmp_check_tier1$CH4_tier1)
quantile(tmp_cattle_CH4_EF$CH4_EF)
## N intake
tmp_sheep_Nin <- tmp_input %>%
# filter sheep
filter(species == "sheep") %>%
# add feed intake data
inner_join(.,tmp_feed_intake) %>%
# estimate CH4 emission from enteric fermentation
rowwise() %>%
mutate(
#  Ym = methane conversion factor, per cent of gross energy in feed converted to methane (Table 10.13)
Ym = 6.7,
# EQUATION 10.21 METHANE EMISSION FACTORS FOR ENTERIC FERMENTATION FROM A LIVESTOCK CATEGORY
## EF = (GE *(Ym / 100)*365)/ 55.65
### EF = emission factor, kg CH4 head-1 yr-1
### GE = gross energy intake, MJ head-1 day-1
### Ym = methane conversion factor, per cent of gross energy in feed converted to methane
### The factor 55.65 (MJ/kg CH4) is the energy content of methane
### here GE_MJ_animal = gross energy intake, MJ head-1 yr-1
EF_Ym = (GE_MJ_animal * (Ym/100)) / 55.65,
# "To estimate total emissions, the selected emission factors are multiplied by the associated animal population [...]. As described above under Tier 1, the emissions estimates should be reported in gigagrams (Gg)." (IPCC Guidelines 2019 Refinements)
## CH4_EF = kg CH4 yr-1
CH4_EF = livestock_head * EF_Ym,
) %>%
ungroup()
tmp_sheep_CH4_EF <- tmp_input %>%
# filter sheep
filter(species == "sheep") %>%
# add feed intake data
inner_join(.,tmp_feed_intake) %>%
# estimate CH4 emission from enteric fermentation
rowwise() %>%
mutate(
#  Ym = methane conversion factor, per cent of gross energy in feed converted to methane (Table 10.13)
Ym = 6.7,
# EQUATION 10.21 METHANE EMISSION FACTORS FOR ENTERIC FERMENTATION FROM A LIVESTOCK CATEGORY
## EF = (GE *(Ym / 100)*365)/ 55.65
### EF = emission factor, kg CH4 head-1 yr-1
### GE = gross energy intake, MJ head-1 day-1
### Ym = methane conversion factor, per cent of gross energy in feed converted to methane
### The factor 55.65 (MJ/kg CH4) is the energy content of methane
### here GE_MJ_animal = gross energy intake, MJ head-1 yr-1
EF_Ym = (GE_MJ_animal * (Ym/100)) / 55.65,
# "To estimate total emissions, the selected emission factors are multiplied by the associated animal population [...]. As described above under Tier 1, the emissions estimates should be reported in gigagrams (Gg)." (IPCC Guidelines 2019 Refinements)
## CH4_EF = kg CH4 yr-1
CH4_EF = livestock_head * EF_Ym,
) %>%
ungroup()
# WIP quality check
quantile(tmp_sheep_CH4_EF)
# WIP quality check
quantile(tmp_sheep_CH4_EF$CH4_EF)
## N intake
tmp_goats_CH4_EF <- tmp_input %>%
# filter sheep
filter(species == "goats") %>%
# add feed intake data
inner_join(.,tmp_feed_intake) %>%
# estimate CH4 emission from enteric fermentation
rowwise() %>%
mutate(
#  Ym = methane conversion factor, per cent of gross energy in feed converted to methane (Table 10.13)
Ym = 5.5,
# EQUATION 10.21 METHANE EMISSION FACTORS FOR ENTERIC FERMENTATION FROM A LIVESTOCK CATEGORY
## EF = (GE *(Ym / 100)*365)/ 55.65
### EF = emission factor, kg CH4 head-1 yr-1
### GE = gross energy intake, MJ head-1 day-1
### Ym = methane conversion factor, per cent of gross energy in feed converted to methane
### The factor 55.65 (MJ/kg CH4) is the energy content of methane
### here GE_MJ_animal = gross energy intake, MJ head-1 yr-1
EF_Ym = (GE_MJ_animal * (Ym/100)) / 55.65,
# "To estimate total emissions, the selected emission factors are multiplied by the associated animal population [...]. As described above under Tier 1, the emissions estimates should be reported in gigagrams (Gg)." (IPCC Guidelines 2019 Refinements)
## CH4_EF = kg CH4 yr-1
CH4_EF = livestock_head * EF_Ym,
) %>%
ungroup()
# quality check => OK !!!
## Table 10.19: N excretion rate for goats in Western EU = 0.46 kg N / 1000kg animal mass / day
## Table 10A.5: Weight goats in Western EU = 40 kg
## => 7 kg N / animal / an
quantile(tmp_goats_CH4_EF$CH4_EF)
CH4_EF <- Reduce(rbind,list(
tmp_cattle_CH4_EF %>% select(farm_id,code_livestock,livestock_unit,CH4_EF),
tmp_sheep_CH4_EF %>% select(farm_id,code_livestock,livestock_unit,CH4_EF),
tmp_goats_CH4_EF %>% select(farm_id,code_livestock,livestock_unit,CH4_EF))) %>%
ungroup()
rm(list = names(.GlobalEnv)[grep("tmp",names(.GlobalEnv))])
load("d:/users/srhuet/documents/GitHub/GHGfromFADN/data/ref_country.rda")
View(ref_country)
View(ref_country)
tmp_MMS <- read.table(unz("data_raw/UNFCCC_ghg_inventories/dnm-2023-crf-14apr23_AR5.zip", "DNM_2023_2018_14042023_135925.xlsx"))
View(tmp_MMS)
library(readxl)
DNM_2023_2018_14042023_135925 <- read_excel("data_raw/UNFCCC_ghg_inventories/DNM_2023_2018_14042023_135925.xlsx",
sheet = "Table3.B(a)s2", range = "A6:M93")
View(DNM_2023_2018_14042023_135925)
tmp_MMS <- read_excel(unz("data_raw/UNFCCC_ghg_inventories/dnm-2023-crf-14apr23_AR5.zip", "DNM_2023_2018_14042023_135925.xlsx"),
sheet = "Table3.B(a)s2", range = "A6:M93")
tmp_MMS <- unz("data_raw/UNFCCC_ghg_inventories/dnm-2023-crf-14apr23_AR5.zip", "DNM_2023_2018_14042023_135925.xlsx")
tmp_MMS <- unz("data_raw/UNFCCC_ghg_inventories/dnm-2023-crf-14apr23_AR5.zip", "DNM_2023_2018_14042023_135925.xlsx")
tmp_MMS <- read_excel(tmp_MMS,sheet = "Table3.B(a)s2", range = "A6:M93")
tmp_MMS <- unzip("data_raw/UNFCCC_ghg_inventories/dnm-2023-crf-14apr23_AR5.zip", "DNM_2023_2018_14042023_135925.xlsx")
tmp_MMS <- read_excel(tmp_MMS,sheet = "Table3.B(a)s2", range = "A6:M93")
View(tmp_MMS)
View(ref_country)
