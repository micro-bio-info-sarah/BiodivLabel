gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "C7:E7",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "F6:H6",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "I5:J5",col_names = T)))))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
rename(.,all_of(tmp_colnames))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\s*\([a-zA-Z0-9]+\)","",Animal_cat))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Option = c(rep("Option_A",4),rep("Option_B",21)),
Animal_cat = gsub("\s*\([a-zA-Z0-9]+\)","",Animal_cat))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Option = c(rep("Option_A",4),rep("Option_B",21)),
Animal_cat = gsub("\S*\([a-zA-Z0-9]+\)","",Animal_cat))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Option = c(rep("Option_A",4),rep("Option_B",21)),
Animal_cat = gsub("\ *\([a-zA-Z0-9]+\)","",Animal_cat))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Option = c(rep("Option_A",4),rep("Option_B",21)),
Animal_cat = gsub("\ \([a-zA-Z0-9]+\)","",Animal_cat))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Option = c(rep("Option_A",4),rep("Option_B",21)),
Animal_cat = gsub("\([a-zA-Z0-9]+\)","",Animal_cat))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Option = c(rep("Option_A",4),rep("Option_B",21)),
Animal_cat = gsub("([a-zA-Z0-9]+)","",Animal_cat))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Option = c(rep("Option_A",4),rep("Option_B",21)),
Animal_cat = gsub("/s*/([a-zA-Z0-9]+/)","",Animal_cat))
?gsub
tmp_MMS2 <- tmp_range %>%
mutate(across(c(5:13), function(x) gsub("\\([a-zA-Z]+",NA,x))) %>%
mutate(across(c(5:13), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Indicator = rep(unique(na.omit(Indicator)),
each = length(unique(na.omit(climate_region))),
times = (length(unique(na.omit(Animal_cat))))),
Animal_cat = rep(unique(na.omit(Animal_cat)),
each = (length(unique(na.omit(climate_region)))) * length(unique(na.omit(Indicator)))),
Option = c(rep("Option_A",12),rep("Option_B",18))) %>%
filter(rowSums(across(c(5:13)),na.rm=T) >0) %>%
mutate(country = tmp_data_country)
# MMS VS and Bo
## Volatile Solis (VS)
## maximum methane producing capacity (Bo)
tmp_range <- read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "A9:J33",col_names = F)
tmp_colnames <- c(1:10) %>%
purrr::set_names(.,c("Animal_cat","Population__size",
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "C7:E7",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "F6:H6",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "I5:J5",col_names = T)))))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("\\([a-zA-Z0-9]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("/s*/([a-zA-Z0-9]+/)","",Animal_cat)) %>%
filter(rowSums(across(c(5:13)),na.rm=T) >0) %>%
mutate(country = tmp_data_country)
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\s*\\([a-zA-Z0-9]+\\)","",Animal_cat))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
filter(rowSums(across(c(5:13)),na.rm=T) >0) %>%
mutate(country = tmp_data_country)
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
filter(rowSums(across(c(2:10)),na.rm=T) >0) %>%
mutate(country = tmp_data_country)
View(tmp_MMS1)
tmp_colnames
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
filter(!is.na('VS(2)_daily_excretion_(average)') & !is.na('CH4_producing_potential_(Bo)(2)_(average)')) %>%
mutate(country = tmp_data_country)
colnames(tmp_MMS1)
# MMS VS and Bo
## Volatile Solis (VS)
## maximum methane producing capacity (Bo)
tmp_range <- read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "A9:J33",col_names = F)
tmp_colnames <- c(1:10) %>%
purrr::set_names(.,c("Animal_cat","Population__size",
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "C7:E7",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "F6:H6",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "I5:J5",col_names = T)))))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
filter(!is.na('VS(2)_daily_excretion_(average)') & !is.na('CH4_producing_potential_(Bo)(2)_(average)')) %>%
mutate(country = tmp_data_country)
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na('VS(2)_daily_excretion_(average)') & !is.na('CH4_producing_potential_(Bo)(2)_(average)')) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
mutate(country = tmp_data_country)
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na("7") & !is.na("8"))
colnames(tmp_range)
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na("...7") & !is.na("...8"))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na(...7) & !is.na(...8))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na(...7) & !is.na(...8)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
mutate(country = tmp_data_country)
tmp_data_year = "2018"
tmp_MMS <- tibble()
for (tmp_zip in list.files("data_raw/UNFCCC_ghg_inventories/")) {
tmp_files = zip_list(paste0("data_raw/UNFCCC_ghg_inventories/",tmp_zip))
tmp_data_country = str_sub(tmp_zip,1,3)
tmp_unzip <- utils::unzip(paste0("data_raw/UNFCCC_ghg_inventories/",tmp_zip),
tmp_files$filename[grep(tmp_data_year,tmp_files$filename)])
# MMS VS and Bo
## Volatile Solis (VS)
## maximum methane producing capacity (Bo)
tmp_range <- read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "A9:J33",col_names = F)
tmp_colnames <- c(1:10) %>%
purrr::set_names(.,c("Animal_cat","Population__size",
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "C7:E7",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "F6:H6",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "I5:J5",col_names = T)))))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na(...7) & !is.na(...8)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
mutate(country = tmp_data_country)
# MMS allocation and MCF
## Allocations
## Methane Conversion Factor (MCF)
tmp_range <- read_excel(tmp_unzip,sheet = "Table3.B(a)s2", range = "A10:M39",col_names = F)
tmp_colnames <- c(1:13) %>%
purrr::set_names(.,c("Option","Animal_cat","Indicator","climate_region",
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s2", range = "E7:M7",col_names = T)))))
tmp_MMS2 <- tmp_range %>%
mutate(across(c(5:13), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(5:13), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Indicator = rep(unique(na.omit(Indicator)),
each = length(unique(na.omit(climate_region))),
times = (length(unique(na.omit(Animal_cat))))),
Animal_cat = rep(unique(na.omit(Animal_cat)),
each = (length(unique(na.omit(climate_region)))) * length(unique(na.omit(Indicator)))),
Option = c(rep("Option_A",12),rep("Option_B",18))) %>%
filter(rowSums(across(c(5:13)),na.rm=T) >0) %>%
mutate(country = tmp_data_country)
# A9:J33
# extract tibble
tmp_MMS <- tmp_MMS %>%
rbind(
full_join(tmp_MMS1,tmp_MMS2)
)
}
View(tmp_MMS)
colnames(tmp_range)
colnames(tmp_MMS1)
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na(...7) & !is.na(...8)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
pivot_longer(.,c("Cool","Temperate","Warm"),names_to = "climate_region",values_to = "alloc_by_climate_region")
View(tmp_MMS1)
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na(...7) & !is.na(...8)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
pivot_longer(.,cols = c("Cool","Temperate","Warm"),names_to = "climate_region",values_to = "alloc_by_climate_region")
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na(...7) & !is.na(...8)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na(...7) & !is.na(...8)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
pivot_longer(.,cols = c("Cool","Temperate","Warm"),names_to = "climate_region",values_to = "alloc_by_climate_region")
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na(...7) & !is.na(...8)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat))
tmp_MMS1 <- tmp_MMS1 %>%
pivot_longer(.,cols = c("Cool","Temperate","Warm"),names_to = "climate_region",values_to = "alloc_by_climate_region")
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na(...7) & !is.na(...8)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
pivot_longer(.,cols = c("Temperate","Warm"),names_to = "climate_region",values_to = "alloc_by_climate_region")
rlang::last_trace()
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na(...7) & !is.na(...8)) %>%
rename(.,all_of(tmp_colnames))
# MMS VS and Bo
## Volatile Solis (VS)
## maximum methane producing capacity (Bo)
tmp_range <- read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "A9:J33",col_names = F)
tmp_colnames <- c(1:10) %>%
purrr::set_names(.,c("Animal_cat","Population__size",
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "C7:E7",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "F6:H6",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "I5:J5",col_names = T)))))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na(...7) & !is.na(...8)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
pivot_longer(.,cols = c("Cool","Temperate","Warm"),names_to = "climate_region",values_to = "alloc_by_climate_region")
View(tmp_MMS1)
View(tmp_range)
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na(...7) & !is.na(...8)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
pivot_longer(.,cols = c("Cool","Temperate","Warm"),names_to = "climate_region",values_to = "alloc_by_climate_region") %>%
filter(!is.na(alloc_by_climate_region)) %>%
mutate(country = tmp_data_country)
for (tmp_zip in list.files("data_raw/UNFCCC_ghg_inventories/")) {
tmp_files = zip_list(paste0("data_raw/UNFCCC_ghg_inventories/",tmp_zip))
tmp_data_country = str_sub(tmp_zip,1,3)
print(tmp_data_country)
tmp_unzip <- utils::unzip(paste0("data_raw/UNFCCC_ghg_inventories/",tmp_zip),
tmp_files$filename[grep(tmp_data_year,tmp_files$filename)])
# MMS VS and Bo
## Volatile Solis (VS)
## maximum methane producing capacity (Bo)
tmp_range <- read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "A9:J33",col_names = F)
tmp_colnames <- c(1:10) %>%
purrr::set_names(.,c("Animal_cat","Population__size",
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "C7:E7",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "F6:H6",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "I5:J5",col_names = T)))))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na(...7) & !is.na(...8)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
pivot_longer(.,cols = c("Cool","Temperate","Warm"),names_to = "climate_region",values_to = "alloc_by_climate_region") %>%
filter(!is.na(alloc_by_climate_region)) %>%
mutate(country = tmp_data_country)
# MMS allocation and MCF
## Allocations
## Methane Conversion Factor (MCF)
tmp_range <- read_excel(tmp_unzip,sheet = "Table3.B(a)s2", range = "A10:M39",col_names = F)
tmp_colnames <- c(1:13) %>%
purrr::set_names(.,c("Option","Animal_cat","Indicator","climate_region",
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s2", range = "E7:M7",col_names = T)))))
tmp_MMS2 <- tmp_range %>%
mutate(across(c(5:13), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(5:13), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Indicator = rep(unique(na.omit(Indicator)),
each = length(unique(na.omit(climate_region))),
times = (length(unique(na.omit(Animal_cat))))),
Animal_cat = rep(unique(na.omit(Animal_cat)),
each = (length(unique(na.omit(climate_region)))) * length(unique(na.omit(Indicator)))),
Option = c(rep("Option_A",12),rep("Option_B",18))) %>%
filter(rowSums(across(c(5:13)),na.rm=T) >0) %>%
mutate(country = tmp_data_country)
# extract tibble
tmp_MMS <- tmp_MMS %>%
rbind(
full_join(tmp_MMS1,tmp_MMS2)
)
}
tmp_data_year = "2018"
tmp_MMS <- tibble()
tmp_data_year = "2018"
tmp_MMS <- tibble()
for (tmp_zip in list.files("data_raw/UNFCCC_ghg_inventories/")) {
tmp_files = zip_list(paste0("data_raw/UNFCCC_ghg_inventories/",tmp_zip))
tmp_data_country = str_sub(tmp_zip,1,3)
print(tmp_data_country)
tmp_unzip <- utils::unzip(paste0("data_raw/UNFCCC_ghg_inventories/",tmp_zip),
tmp_files$filename[grep(tmp_data_year,tmp_files$filename)])
# MMS VS and Bo
## Volatile Solis (VS)
## maximum methane producing capacity (Bo)
tmp_range <- read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "A9:J33",col_names = F)
tmp_colnames <- c(1:10) %>%
purrr::set_names(.,c("Animal_cat","Population__size",
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "C7:E7",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "F6:H6",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "I5:J5",col_names = T)))))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na(...7) & !is.na(...8)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
pivot_longer(.,cols = c("Cool","Temperate","Warm"),names_to = "climate_region",values_to = "alloc_by_climate_region") %>%
filter(!is.na(alloc_by_climate_region)) %>%
mutate(country = tmp_data_country)
# MMS allocation and MCF
## Allocations
## Methane Conversion Factor (MCF)
tmp_range <- read_excel(tmp_unzip,sheet = "Table3.B(a)s2", range = "A10:M39",col_names = F)
tmp_colnames <- c(1:13) %>%
purrr::set_names(.,c("Option","Animal_cat","Indicator","climate_region",
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s2", range = "E7:M7",col_names = T)))))
tmp_MMS2 <- tmp_range %>%
mutate(across(c(5:13), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(5:13), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Indicator = rep(unique(na.omit(Indicator)),
each = length(unique(na.omit(climate_region))),
times = (length(unique(na.omit(Animal_cat))))),
Animal_cat = rep(unique(na.omit(Animal_cat)),
each = (length(unique(na.omit(climate_region)))) * length(unique(na.omit(Indicator)))),
Option = c(rep("Option_A",12),rep("Option_B",18))) %>%
filter(rowSums(across(c(5:13)),na.rm=T) >0) %>%
mutate(country = tmp_data_country)
# extract tibble
tmp_MMS <- tmp_MMS %>%
rbind(
full_join(tmp_MMS1,tmp_MMS2)
)
}
colnames(tmp_MMS1)
# MMS VS and Bo
## Volatile Solis (VS)
## maximum methane producing capacity (Bo)
tmp_range <- read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "A9:J33",col_names = F)
tmp_colnames <- c(1:10) %>%
purrr::set_names(.,c("Animal_cat","Population__size",
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "C7:E7",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "F6:H6",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "I5:J5",col_names = T)))))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na(...7) & !is.na(...8)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
pivot_longer(.,cols = c("Cool","Temperate","Warm"),names_to = "climate_region",values_to = "alloc_by_climate_region") %>%
filter(!is.na(alloc_by_climate_region)) %>%
mutate(country = tmp_data_country)
View(tmp_MMS2)
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na(...7) & !is.na(...8)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
pivot_longer(.,cols = c("Cool","Temperate","Warm"),names_to = "climate_region",values_to = "alloc_by_climate_region") %>%
filter(!is.na(alloc_by_climate_region)) %>%
pivot_longer(.,
cols = c("Population__size","Typical_animal_mass_(average)","VS(2)_daily_excretion_(average)",
"CH4_producing_potential_(Bo)(2)_(average)","IMPLIED_EMISSION_FACTORS","EMISSIONS"),
names_to = "Indicator",values_to = "value") %>%
mutate(country = tmp_data_country)
View(tmp_MMS1)
full_join(tmp_MMS1,tmp_MMS2)
tmp_data_year = "2018"
tmp_MMS <- tibble()
for (tmp_zip in list.files("data_raw/UNFCCC_ghg_inventories/")) {
tmp_files = zip_list(paste0("data_raw/UNFCCC_ghg_inventories/",tmp_zip))
tmp_data_country = str_sub(tmp_zip,1,3)
print(tmp_data_country)
tmp_unzip <- utils::unzip(paste0("data_raw/UNFCCC_ghg_inventories/",tmp_zip),
tmp_files$filename[grep(tmp_data_year,tmp_files$filename)])
# MMS VS and Bo
## Volatile Solis (VS)
## maximum methane producing capacity (Bo)
tmp_range <- read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "A9:J33",col_names = F)
tmp_colnames <- c(1:10) %>%
purrr::set_names(.,c("Animal_cat","Population__size",
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "C7:E7",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "F6:H6",col_names = T))),
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s1", range = "I5:J5",col_names = T)))))
tmp_MMS1 <- tmp_range %>%
mutate(across(c(2:10), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(2:10), as.numeric)) %>%
filter(!is.na(...7) & !is.na(...8)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Animal_cat = gsub("\\([a-zA-Z0-9]+\\)","",Animal_cat)) %>%
pivot_longer(.,cols = c("Cool","Temperate","Warm"),names_to = "climate_region",values_to = "alloc_by_climate_region") %>%
filter(!is.na(alloc_by_climate_region)) %>%
pivot_longer(.,
cols = c("Population__size","Typical_animal_mass_(average)","VS(2)_daily_excretion_(average)",
"CH4_producing_potential_(Bo)(2)_(average)","IMPLIED_EMISSION_FACTORS","EMISSIONS"),
names_to = "Indicator",values_to = "value") %>%
mutate(country = tmp_data_country)
# MMS allocation and MCF
## Allocations
## Methane Conversion Factor (MCF)
tmp_range <- read_excel(tmp_unzip,sheet = "Table3.B(a)s2", range = "A10:M39",col_names = F)
tmp_colnames <- c(1:13) %>%
purrr::set_names(.,c("Option","Animal_cat","Indicator","climate_region",
gsub(" ","_",colnames(read_excel(tmp_unzip,sheet = "Table3.B(a)s2", range = "E7:M7",col_names = T)))))
tmp_MMS2 <- tmp_range %>%
mutate(across(c(5:13), function(x) gsub("[a-zA-Z]+",NA,x))) %>%
mutate(across(c(5:13), as.numeric)) %>%
rename(.,all_of(tmp_colnames)) %>%
mutate(
Indicator = rep(unique(na.omit(Indicator)),
each = length(unique(na.omit(climate_region))),
times = (length(unique(na.omit(Animal_cat))))),
Animal_cat = rep(unique(na.omit(Animal_cat)),
each = (length(unique(na.omit(climate_region)))) * length(unique(na.omit(Indicator)))),
Option = c(rep("Option_A",12),rep("Option_B",18))) %>%
filter(rowSums(across(c(5:13)),na.rm=T) >0) %>%
mutate(country = tmp_data_country)
# extract tibble
tmp_MMS <- tmp_MMS %>%
rbind(
full_join(tmp_MMS1,tmp_MMS2)
)
}
View(tmp_MMS)
rm(list = names(.GlobalEnv)[grep("tmp",names(.GlobalEnv))])
